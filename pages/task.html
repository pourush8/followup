<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>followUp - Tasks</title>
    <link rel="stylesheet" href="../styles/base.css">
    <link rel="stylesheet" href="../styles/task.css">
    <link rel="stylesheet" href="../styles/ai-chat.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="branding"><a href="../index.html">followUp</a></div>
        <div class="user-profile">
            <img src="https://lh3.googleusercontent.com/a/ACg8ocKcbGWCPMhuBIO7dKfRcdoTU032Cxt4-pXLSDFzZ_DLHxt5FAM7yg=s288-c-no" alt="Pourush Kalra" title="Pourush Kalra">
        </div>
    </header>

    <div class="sidebar">
        <h3>Tasks</h3>
        <ul class="task-list">
            <!-- <li class="task-item draft">
                Draft: Google form filing
            </li> -->
            <li class="task-item">
                <span>Respond on high priority ticket DEV-19283</span>
                <canvas id="chart1" class="progress-chart"></canvas>
            </li>
            <li class="task-item">
                <span>Announcement: Address security threat, phishing attempt on Jan 12th</span>
                <canvas id="chart2" class="progress-chart"></canvas>
                <a href="task-status.html" class="task-overlay" aria-label="View task status"></a>
            </li>
            <li class="task-item">
                <span>Fill leadership feedback form</span>
                <canvas id="chart3" class="progress-chart"></canvas>
            </li>
            <li class="task-item">
                <span>Survey: Vote on team outing</span>
                <canvas id="chart4" class="progress-chart"></canvas>
            </li>
            <li class="task-item">
                <span>MS Form: Fill entries on Capex form</span>
                <canvas id="chart5" class="progress-chart"></canvas>
            </li>
            <li class="timesheet-parent">
                <div class="timesheet-header">
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                    </svg>
                    <span>Fill Timesheet</span>
                </div>
                <ul class="timesheet-items">
                    <li class="task-item">
                        <span>Fill Timesheet - 01/16/24 - 01/31/24</span>
                        <canvas id="timesheet1" class="progress-chart"></canvas>
                    </li>
                    <li class="task-item">
                        <span>Fill Timesheet - 02/01/24 - 02/15/24</span>
                        <canvas id="timesheet2" class="progress-chart"></canvas>
                    </li>
                    <li class="task-item">
                        <span>Fill Timesheet - 02/16/24 - 02/29/24</span>
                        <canvas id="timesheet3" class="progress-chart"></canvas>
                    </li>
                    <li class="task-item">
                        <span>Fill Timesheet - 03/01/24 - 03/15/24</span>
                        <canvas id="timesheet4" class="progress-chart"></canvas>
                    </li>
                </ul>
            </li>
        </ul>
    </div>

    <main class="with-sidebar">
        <div class="container">
            <nav class="process-flow">
                <ul>
                    <li class="active"><a href="task.html">Task</a></li>
                    <li><a href="people.html">People</a></li>
                    <li><a href="followup.html">followUp Scheme</a></li>
                    <li><a href="notification-message.html">Notification Message</a></li>
                    <li><a href="summary.html">Summary</a></li>
                </ul>
            </nav>
            <div class="search-container">
                <input type="text" placeholder="Add from 100's of integrations" class="search-input">
            </div>
            <div class="integration-tiles">
                <div class="tile" id="define-manual-task">
                    <div class="tile-icon">+</div>
                    <div class="tile-name">Define Manual Task</div>
                </div>
                <div class="tile">
                    <div class="tile-icon"><img src="https://img.icons8.com/color/48/000000/survey.png" alt="One Question Survey"></div>
                    <div class="tile-name">One Question Survey</div>
                </div>
                <div class="tile">
                    <div class="tile-icon"><img src="https://img.icons8.com/color/48/000000/megaphone.png" alt="Announcement"></div>
                    <div class="tile-name">Announcement</div>
                </div>
                <div class="tile">
                    <div class="tile-icon"><img src="https://www.gstatic.com/images/branding/product/1x/forms_48dp.png" alt="Google Forms"></div>
                    <div class="tile-name">Google Form</div>
                </div>
                <div class="tile">
                    <div class="tile-icon"><img src="https://www.sap.com/dam/application/shared/logos/sap-logo-svg.svg" alt="SAP Concur"></div>
                    <div class="tile-name">Time Sheet Follow Up</div>
                </div>
                <div class="tile">
                    <div class="tile-icon"><img src="https://logovectordl.com/wp-content/uploads/2020/11/docebo-logo-vector.png" alt="Docebo"></div>
                    <div class="tile-name">Follow up on Training</div>
                </div>
                <div class="tile">
                    <div class="tile-icon"><img src="https://img.icons8.com/color/48/000000/microsoft-forms.png" alt="Microsoft Forms"></div>
                    <div class="tile-name">Microsoft Forms</div>
                </div>
                <div class="tile">
                    <div class="tile-icon"><img src="https://wac-cdn.atlassian.com/assets/img/favicons/atlassian/favicon.png" alt="Jira Service Desk"></div>
                    <div class="tile-name">Address Critical Incident</div>
                </div>
                <!-- New Webhooks Tile -->
                <div class="tile">
                    <div class="tile-icon"><img src="https://i.sstatic.net/S3SNU.jpg" alt="Webhooks" style="width: 48px; height: 48px;"></div>
                    <div class="tile-name">Webhooks</div>
                </div>
            </div>

            <div class="integration-grid">
                <!-- Your existing integration tiles -->
            </div>

            <div class="workflow-section">
                <div class="ai-input-container">
                    <div class="glow-border"></div>
                    <div class="ai-prompt">
                        <div class="ai-icon-wrapper">
                            <span class="ai-icon">ðŸ¤–</span>
                            <span class="pulse"></span>
                        </div>
                        <p>AI Workflow Assistant</p>
                    </div>
                    <div class="input-wrapper">
                        <textarea 
                            id="aiInput" 
                            placeholder="Describe your workflow and I'll create it automatically..."
                            rows="1"
                        ></textarea>
                        <button id="processWorkflow">
                            <span>Create</span>
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const aiInput = document.getElementById('aiInput');
            const processBtn = document.getElementById('processWorkflow');

            // Auto-resize textarea
            aiInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            processBtn.addEventListener('click', async function() {
                const message = aiInput.value.trim();
                if (!message) return;

                // Disable input and show loading state
                aiInput.disabled = true;
                processBtn.disabled = true;
                processBtn.classList.add('loading');
                processBtn.innerHTML = 'Processing...';

                // Simulate AI processing
                setTimeout(() => {
                    window.location.href = 'summary.html';
                }, 2000);
            });

            // Handle Enter key
            aiInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    processBtn.click();
                }
            });

            // Update selectors to match the actual card elements
            const taskCards = document.querySelectorAll('.card');
            let currentPopup = null;

            taskCards.forEach(card => {
                const popup = card.querySelector('.popup');
                
                card.addEventListener('mouseenter', () => {
                    // Hide previous popup if exists
                    if (currentPopup && currentPopup !== popup) {
                        currentPopup.classList.remove('show');
                    }
                    
                    // Show current popup
                    popup.classList.add('show');
                    currentPopup = popup;
                });

                card.addEventListener('mouseleave', (e) => {
                    // Check if we're not hovering over the popup
                    if (popup) {
                        const rect = popup.getBoundingClientRect();
                        const isOverPopup = (
                            e.clientX >= rect.left &&
                            e.clientX <= rect.right &&
                            e.clientY >= rect.top &&
                            e.clientY <= rect.bottom
                        );

                        if (!isOverPopup) {
                            popup.classList.remove('show');
                            currentPopup = null;
                        }
                    }
                });

                // Handle popup mouseleave if popup exists
                if (popup) {
                    popup.addEventListener('mouseleave', () => {
                        popup.classList.remove('show');
                        currentPopup = null;
                    });
                }
            });

            // Close popup when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.card')) {
                    document.querySelectorAll('.popup.show').forEach(popup => {
                        popup.classList.remove('show');
                    });
                    currentPopup = null;
                }
            });

            // Restore popup functionality
            const tiles = document.querySelectorAll('.tile');
            const popups = document.querySelectorAll('.popup');
            const closeButtons = document.querySelectorAll('.btn-secondary');

            // Handle tile clicks
            tiles.forEach(tile => {
                tile.addEventListener('click', () => {
                    const tileId = tile.id;
                    const correspondingPopup = document.getElementById(`${tileId}-popup`);
                    
                    if (correspondingPopup) {
                        // Hide any other open popups
                        popups.forEach(popup => popup.style.display = 'none');
                        // Show this popup
                        correspondingPopup.style.display = 'block';
                    }
                });
            });

            // Handle close buttons
            closeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const popup = button.closest('.popup');
                    if (popup) {
                        popup.style.display = 'none';
                    }
                });
            });

            // Close popup when clicking outside
            window.addEventListener('click', (e) => {
                popups.forEach(popup => {
                    if (e.target === popup) {
                        popup.style.display = 'none';
                    }
                });
            });

            // Handle form submissions
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // Handle form submission logic here
                    const popup = form.closest('.popup');
                    if (popup) {
                        popup.style.display = 'none';
                    }
                });
            });

            // Manual Task Popup
            const defineManualTask = document.getElementById('define-manual-task');
            const popup = document.getElementById('manual-task-popup');
            const closePopup = document.getElementById('close-popup');
            const form = document.getElementById('manual-task-form');

            defineManualTask.addEventListener('click', function() {
                popup.style.display = 'flex';
            });

            closePopup.addEventListener('click', function() {
                popup.style.display = 'none';
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const summary = document.getElementById('task-summary').value;
                const definitionOfDone = document.querySelector('input[name="definition-of-done"]:checked').value;
                console.log('Task created:', { summary, definitionOfDone });
                popup.style.display = 'none';
                form.reset();
                window.location.href = 'people.html';
            });

            // Google Form Popup
            const googleFormTile = Array.from(document.querySelectorAll('.tile')).find(tile => 
                tile.querySelector('.tile-name').textContent === 'Google Form'
            );
            const googleFormPopup = document.getElementById('google-form-popup');
            const closeGoogleFormPopup = document.getElementById('close-google-form-popup');
            const googleFormTaskForm = document.getElementById('google-form-task');

            googleFormTile.addEventListener('click', function() {
                googleFormPopup.style.display = 'flex';
            });

            closeGoogleFormPopup.addEventListener('click', function() {
                googleFormPopup.style.display = 'none';
            });

            googleFormTaskForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const summary = document.getElementById('task-summary').value;
                const selectedForm = document.getElementById('google-form-select').value;
                console.log('Google Form task created:', { summary, selectedForm });
                googleFormPopup.style.display = 'none';
                googleFormTaskForm.reset();
                window.location.href = 'people.html';
            });
        });
    </script>

    <!-- Popup for Define Manual Task -->
    <div id="manual-task-popup" class="popup">
        <div class="popup-content">
            <h2>Define Manual Task</h2>
            <form id="manual-task-form">
                <div class="form-group">
                    <label for="task-summary">Task Summary</label>
                    <input type="text" id="task-summary" name="task-summary" required>
                </div>
                
                <div class="form-group">
                    <label>Definition of Done</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="definition-of-done" value="user-confirmation" required>
                            <span>User confirms completion</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="definition-of-done" value="system-tracking" required>
                            <span>System tracks completion</span>
                        </label>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn-secondary" id="close-popup">Cancel</button>
                    <button type="submit" class="btn-primary">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <div id="google-form-popup" class="popup">
        <div class="popup-content">
            <h2>Create Google Form Follow-up</h2>
            <form id="google-form-task">
                <div class="form-group">
                    <label for="task-summary">Task Summary</label>
                    <input type="text" id="task-summary" name="task-summary" required>
                </div>
                
                <div class="form-group">
                    <label for="google-form-select">Select Google Form</label>
                    <select id="google-form-select" name="google-form-select" required>
                        <option value="">Choose a form</option>
                        <option value="employee-feedback">Employee Feedback Survey</option>
                        <option value="training-evaluation">Training Evaluation Form</option>
                        <option value="it-support-request">IT Support Request Form</option>
                        <option value="expense-report">Expense Report Submission</option>
                        <option value="leave-request">Leave Request Form</option>
                        <option value="performance-review">Performance Review Self-Assessment</option>
                        <option value="onboarding-checklist">New Employee Onboarding Checklist</option>
                        <option value="project-status">Project Status Update Form</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn-secondary" id="close-google-form-popup">Cancel</button>
                    <button type="submit" class="btn-primary">Create Task</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
